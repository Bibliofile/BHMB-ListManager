{"version":3,"file":"bundle.js","sources":["../src/index.ts"],"sourcesContent":["import { MessageBot } from '@bhmb/bot'\nimport { UIExtensionExports } from '@bhmb/ui'\n\nimport tabContent from \"./tab.html\"\n\ntype WorldLists = import(\"blockheads-api-interface\").WorldLists;\n\ninterface StoredList {\n  id: string;\n  list_id: keyof WorldLists;\n  list: string[];\n}\n\nMessageBot.registerExtension('bibliofile/lists-editor', function (ex) {\n  const storedLists = ex.storage.get<StoredList[]>(\"lists\", []);\n\n  const resetLists: WorldLists = {\n    adminlist: [],\n    modlist: [],\n    whitelist: [],\n    blacklist: [],\n  };\n\n  ex.world.addCommand(\"list\", (player, args) => {\n    const [command, listId] = args.split(/\\s+/);\n\n    if (!player.isOwner) return;\n    if (![\"apply\", \"reset\"].includes(command)) return;\n\n    const listToUse = storedLists.find(list => list.id === listId);\n    if (!listToUse) {\n      ex.bot.send(\"ERROR: /list could not find requsted list.\");\n      return;\n    }\n\n    if (command === \"reset\") {\n      ex.world.setLists({\n        [listToUse.list_id]: resetLists[listToUse.list_id]\n      })\n      .then(() => ex.bot.send(`Reset ${listToUse.list_id} to previous list.`))\n      .catch(console.error);\n    } else { // command = \"apply\"\n      ex.world.getLists().then(lists => {\n        resetLists[listToUse.list_id] = lists[listToUse.list_id];\n        return ex.world.setLists({\n          [listToUse.list_id]: listToUse.list\n        })\n      })\n      .then(() => ex.bot.send(`Set ${listToUse.list_id} to ${listToUse.id} list.`))\n      .catch(console.error);\n    }\n  });\n\n  ex.remove = () => ex.world.removeCommand(\"list\");\n\n  const ui = ex.bot.getExports('ui') as UIExtensionExports | undefined\n  if (!ui) return\n\n  const tab = ui.addTab(\"List Editor\");\n  tab.innerHTML = tabContent;\n\n  const template = tab.querySelector(\"template\")!;\n  const listsContainer = tab.querySelector(\".lists\") as HTMLElement;\n\n  storedLists.forEach(addList);\n\n  function addList(list: StoredList) {\n    if (!ui) return;\n\n    ui.buildTemplate(template, listsContainer, [\n      {\n        selector: \"summary\",\n        text: list.id\n      },\n      {\n        selector: \"[data-for='id']\",\n        value: list.id\n      },\n      {\n        selector: \"[data-for='list']\",\n        value: list.list_id\n      },\n      {\n        selector: \"[data-for='content']\",\n        value: list.list.join('\\n')\n      }\n    ])\n  }\n\n  function saveLists() {\n    storedLists.length = 0;\n\n    for (const list of listsContainer.querySelectorAll(\"details\")) {\n      const listId = list.querySelector<HTMLInputElement>(\"[data-for='id']\")!.value;\n\n      list.querySelector(\"summary\")!.textContent = listId;\n\n      storedLists.push({\n        id: listId,\n        list_id: list.querySelector<HTMLSelectElement>(\"[data-for='list']\")!.value as keyof WorldLists,\n        list: list.querySelector<HTMLTextAreaElement>(\"[data-for='content']\")!.value.split(\"\\n\")\n      });\n    }\n\n    ex.storage.set(\"lists\", storedLists);\n  }\n\n  listsContainer.addEventListener(\"click\", event => {\n    const target = event.target;\n    if (target instanceof HTMLButtonElement && target.dataset.do === \"delete\") {\n      target.parentElement?.nextElementSibling?.remove();\n      target.parentElement?.remove();\n      saveLists();\n    }\n  })\n\n  listsContainer.addEventListener('change', saveLists);\n  listsContainer.addEventListener('input', saveLists);\n\n  tab.querySelector('.is-adding-message')?.addEventListener(\"click\", () => {\n    addList({\n      id: Math.random().toString(16).slice(2, 8),\n      list_id: \"adminlist\",\n      list: []\n    });\n    saveLists();\n  })\n})\n"],"names":["MessageBot"],"mappings":"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"}